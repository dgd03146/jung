# yaml-language-server: $schema=https://coderabbit.ai/integrations/schema.v2.json
language: "ko-KR"
early_access: false

# 250ì ì œí•œ ì¤€ìˆ˜ (í•µì‹¬ë§Œ ê°„ê²°í•˜ê²Œ)
tone_instructions: >
  Tossê¸‰ ì•„í‚¤í…ì²˜ ì „ë¬¸ê°€. Readability/Predictability/Cohesion/Low Coupling ì›ì¹™.
  React 18, TS, TanStack Query v5, FSD.
  í•„ìˆ˜: Magic numbersâ†’ìƒìˆ˜, ì¡°ê±´â†’ëª…ëª…ë³€ìˆ˜, Props drillingâ†’Composition, useEffect=ì™¸ë¶€ë™ê¸°í™”ë§Œ, Query hooks=QueryResult ë°˜í™˜.

reviews:
  profile: "chill"
  request_changes_workflow: true
  high_level_summary: true
  poem: false
  review_status: true
  collapse_walkthrough: true

  auto_review:
    enabled: true
    drafts: false
    base_branches: ["main", "dev", "release"]

  # ë¹Œë“œ ì‚°ì¶œë¬¼ ë° ìƒì„± ì½”ë“œ ì œì™¸
  path_filters:
    - "!**/node_modules/**"
    - "!**/dist/**"
    - "!**/.next/**"
    - "!**/build/**"
    - "!**/coverage/**"
    - "!**/.turbo/**"
    - "!**/storybook-static/**"
    - "!**/*.gen.ts"
    - "!**/routeTree.gen.ts"

  # WIP/Draft PR ìë™ ìŠ¤í‚µ
  ignore_title_keywords:
    - "wip"
    - "draft"
    - "[skip ci]"
    - "[ci skip]"

  path_instructions:
    # ============================================
    # ğŸ“‹ Readability Rules (ê°€ë…ì„±)
    # ============================================
    - path: "**/*.{ts,tsx}"
      instructions: |
        ğŸ” Readability (rules/frontend-design.md ê¸°ì¤€):

        1. Magic numbers â†’ Named constants
           âŒ await delay(300);
           âœ… const ANIMATION_DELAY_MS = 300; await delay(ANIMATION_DELAY_MS);

        2. ë³µì¡í•œ ì¡°ê±´ â†’ ëª…ëª…ëœ ë³€ìˆ˜
           âŒ if (age >= 18 && hasConsent && !isBanned)
           âœ… const isEligible = age >= 18 && hasConsent && !isBanned;

        3. ì¡°ê±´ë¶€ ë Œë”ë§ â†’ ì „ìš© ì»´í¬ë„ŒíŠ¸ ë¶„ë¦¬
           âŒ {role === 'admin' ? <AdminButton /> : <ViewerButton />}
           âœ… <RoleBasedButton role={role} />

        4. ì¤‘ì²© ì‚¼í•­ ì—°ì‚°ì ê¸ˆì§€ â†’ IIFE ë˜ëŠ” early return
           const status = (() => {
             if (A && B) return 'BOTH';
             if (A) return 'A';
             return 'NONE';
           })();

    # ============================================
    # ğŸ¯ Predictability Rules (ì˜ˆì¸¡ ê°€ëŠ¥ì„±)
    # ============================================
    - path: "**/hooks/**/*.{ts,tsx}"
      instructions: |
        ğŸ¯ Predictability (TanStack Query v5):

        1. Query hooksëŠ” ì „ì²´ QueryResult<T, Error> ë°˜í™˜
           âŒ export function useUser(id: string) { return useQuery(...).data; }
           âœ… export function useUser(id: string): UseQueryResult<User, Error> { return useQuery(...); }

        2. queryKeyì— ëª¨ë“  íŒŒë¼ë¯¸í„° í¬í•¨ (ë ˆì´ìŠ¤ ì»¨ë””ì…˜ ë°©ì§€, tkdodo.eu)
           âœ… queryKey: ['posts', { status, page, limit }]

        3. enabledë¡œ ì¡°ê±´ë¶€ ì¿¼ë¦¬ (v5 í‘œì¤€)
           useQuery({ ...userQuery(id), enabled: Boolean(id) })

        4. queryOptions() í—¬í¼ë¡œ ì˜µì…˜ ê³µí†µí™”
           export const postQuery = (id: string) => queryOptions({
             queryKey: ['post', id],
             queryFn: () => fetchPost(id),
             staleTime: 60_000,
             gcTime: 5 * 60_000,  // v5ì—ì„œ cacheTime â†’ gcTime
           });

        5. í•¨ìˆ˜ëª…ì€ ë¶€ìˆ˜íš¨ê³¼ ëª…í™•íˆ
           âœ… fetchUserWithAuth(), logAnalyticsEvent()
           âŒ handleData(), doStuff()

    # ============================================
    # ğŸ§© Cohesion Rules (ì‘ì§‘ë„)
    # ============================================
    - path: "apps/web/src/features/**/*.{ts,tsx}"
      instructions: |
        ğŸ§© Cohesion (FSD + Toss ì›ì¹™):

        FSD features êµ¬ì¡°:
        - api/: TanStack Query hooks
        - model/: ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ hooks (useXXX)
        - ui/: í”„ë ˆì  í…Œì´ì…˜ ì»´í¬ë„ŒíŠ¸
        - lib/: ìˆœìˆ˜ í•¨ìˆ˜
        - config/: ìƒìˆ˜

        í•„ìˆ˜:
        - ë‹¨ë°©í–¥ ì˜ì¡´ì„±: features â†’ entities â†’ shared
        - ë‹¨ì¼ ì±…ì„ ì›ì¹™ (SRP)
        - ê´€ë ¨ ìƒìˆ˜ëŠ” ë¡œì§ ê·¼ì²˜ ë°°ì¹˜
        - Form cohesion: í•„ë“œ ê°„ ì˜ì¡´ì„± ìˆìœ¼ë©´ form-level schema

    - path: "apps/web/src/entities/**/*.{ts,tsx}"
      instructions: |
        ğŸ§© FSD entities = ìˆœìˆ˜ ë°ì´í„° ë ˆì´ì–´:

        - api/: Query hooks (QueryResult<T> ë°˜í™˜)
        - ui/: Stateless í”„ë ˆì  í…Œì´ì…˜ ì»´í¬ë„ŒíŠ¸
        - model/: íƒ€ì… ì •ì˜, ìƒìˆ˜

        ê¸ˆì§€:
        - âŒ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ (featuresì—ì„œ)
        - âŒ features ë ˆì´ì–´ ì˜ì¡´
        - âŒ any íƒ€ì…

    - path: "apps/web/src/shared/**/*.{ts,tsx}"
      instructions: |
        ğŸ§© Shared = ë²”ìš© ë ˆì´ì–´ (ë„ë©”ì¸ ë¡œì§ ê¸ˆì§€):

        - ui/: Polymorphic ì»´í¬ë„ŒíŠ¸, ì ‘ê·¼ì„± í•„ìˆ˜
        - hooks/: ì œë„¤ë¦­ ê¸°ë°˜ (useDebounce<T>, useLocalStorage<T>)
        - lib/: ìˆœìˆ˜ í•¨ìˆ˜ (formatDate, cn, validate*)
        - api/: tRPC í´ë¼ì´ì–¸íŠ¸
        - config/: ì „ì—­ ìƒìˆ˜

    # ============================================
    # ğŸ”— Coupling Rules (ê²°í•©ë„)
    # ============================================
    - path: "apps/web/src/**/*.{ts,tsx}"
      instructions: |
        ğŸ”— Low Coupling (Toss ì›ì¹™):

        1. Props drilling ê¸ˆì§€ â†’ Composition íŒ¨í„´
           âŒ <Parent><Child><GrandChild prop={x} /></Child></Parent>
           âœ… <Modal>{children}</Modal>

        2. ì¡°ê¸° ì¶”ìƒí™” ë°©ì§€
           - ì‚¬ìš© ì¼€ì´ìŠ¤ 2ê°œ ì´í•˜ë©´ ì¤‘ë³µ í—ˆìš©
           - 3ê°œ ì´ìƒì´ê³  íŒ¨í„´ ëª…í™•í•  ë•Œë§Œ ì¶”ìƒí™”

        3. ìƒíƒœ ê´€ë¦¬ ë²”ìœ„ ì¢ê²Œ
           âŒ useGlobalState()
           âœ… useCardIdParam(), useDateRangeParam()

    # ============================================
    # âš¡ Effect Hygiene (React ê³µì‹ ë¬¸ì„œ ê¸°ì¤€)
    # ============================================
    - path: "**/*.{ts,tsx}"
      instructions: |
        âš¡ useEffectëŠ” ì™¸ë¶€ ì‹œìŠ¤í…œ ë™ê¸°í™”ë§Œ (react.dev):

        í—ˆìš© (ì™¸ë¶€ ì‹œìŠ¤í…œ):
        âœ… íƒ€ì´ë¨¸ (setTimeout, setInterval)
        âœ… êµ¬ë… (WebSocket, EventSource)
        âœ… ë¹„-React ìœ„ì ¯ (ì§€ë„, ì°¨íŠ¸)
        âœ… ë¸Œë¼ìš°ì € API (IntersectionObserver, localStorage sync)

        ê¸ˆì§€:
        âŒ ë°ì´í„° í˜ì¹­ (TanStack Query ì‚¬ìš©)
        âŒ íŒŒìƒ ìƒíƒœ (ë Œë” ì‹œ ê³„ì‚°)
        âŒ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ë¡œì§ (onClickì—ì„œ ì§ì ‘)

        ì˜ˆì‹œ:
        âŒ const [fullName, setFullName] = useState('');
           useEffect(() => setFullName(`${first} ${last}`), [first, last]);
        âœ… const fullName = `${first} ${last}`;

    # ============================================
    # â™¿ Accessibility (WAI-ARIA)
    # ============================================
    - path: "**/*.{ts,tsx}"
      instructions: |
        â™¿ Accessibility (Native First, ARIA Second):

        1. ë„¤ì´í‹°ë¸Œ ìš”ì†Œ ìš°ì„ 
           âœ… <button>, <a>, <input>, <select>

        2. ARIAëŠ” ë³´ì¡°
           <button type="button" aria-pressed={isOn}>Mute</button>

        3. í‚¤ë³´ë“œ ë„¤ë¹„ê²Œì´ì…˜
           - Tab, Enter, Escape, Arrow keys

        4. í¬ì»¤ìŠ¤ ê´€ë¦¬
           - focus-visible, focus trap in modal

    # ============================================
    # ğŸ¨ Styling (Vanilla Extract)
    # ============================================
    - path: "**/*.css.ts"
      instructions: |
        ğŸ¨ Vanilla Extract (ì œë¡œ ëŸ°íƒ€ì„):

        1. ë””ìì¸ í† í° í™œìš©
           import { colors, spacing } from '@design-system/tokens';

        2. Recipesë¡œ variant
           export const button = recipe({
             base: { padding: '8px 16px' },
             variants: { size: { sm: {...}, lg: {...} } }
           });

        3. ê¸ˆì§€
           âŒ ì¸ë¼ì¸ ìŠ¤íƒ€ì¼ (style={{ ... }})
           âŒ Magic numbers (spacing.md ì‚¬ìš©)

        4. ë„¤ì´ë°: camelCase

    # ============================================
    # ğŸ”§ TanStack Query v5 (Best Practices)
    # ============================================
    - path: "**/api/**/*.{ts,tsx}"
      instructions: |
        ğŸ”§ TanStack Query v5 + TkDodo íŒ¨í„´:

        1. queryKeyì— ëª¨ë“  íŒŒë¼ë¯¸í„° (tkdodo.eu/effective-react-query-keys)
           queryKey: ['user', id, { filter, sort }]

        2. queryOptions()ë¡œ ì˜µì…˜ ê³µí†µí™”
           export const userQuery = (id: string) => queryOptions({
             queryKey: ['user', id],
             queryFn: () => fetchUser(id),
             staleTime: 60_000,
             gcTime: 5 * 60_000,  // v5 rename (cacheTime â†’ gcTime)
           });

        3. enabledë¡œ ì¡°ê±´ë¶€ ì¿¼ë¦¬
           useQuery({ ...userQuery(id), enabled: Boolean(id) })

        4. ë‚™ê´€ì  ì—…ë°ì´íŠ¸ 3ë‹¨ê³„
           onMutate: async (newData) => {
             await queryClient.cancelQueries(['posts']);
             const previous = queryClient.getQueryData(['posts']);
             queryClient.setQueryData(['posts'], old => [...old, newData]);
             return { previous };
           }
           onError: (err, vars, context) => {
             queryClient.setQueryData(['posts'], context.previous);
           }
           onSettled: () => {
             queryClient.invalidateQueries(['posts']);
           }

    # ============================================
    # ğŸ›¡ï¸ Type Safety (TypeScript)
    # ============================================
    - path: "**/*.{ts,tsx}"
      instructions: |
        ğŸ›¡ï¸ TypeScript í’ˆì§ˆ:

        1. any íƒ€ì… ê¸ˆì§€
           âœ… unknown â†’ íƒ€ì… ê°€ë“œ

        2. Discriminated Union í™œìš©
           type Result<T> =
             | { ok: true; data: T }
             | { ok: false; error: string };

        3. ì œë„¤ë¦­ìœ¼ë¡œ ì¬ì‚¬ìš©ì„±
           function useDebounce<T>(value: T, delay: number): T

    # ============================================
    # ğŸ§ª Testing
    # ============================================
    - path: "**/*.test.{ts,tsx}"
      instructions: |
        ğŸ§ª Unit Test í’ˆì§ˆ:

        1. ì„¤ëª…ì ì¸ í…ŒìŠ¤íŠ¸ëª…
           âœ… describe('useAgeFilter', () => {
                it('should update URL when age range changes', () => {...})
              })

        2. AAA íŒ¨í„´
           // Arrange
           const { result } = renderHook(() => useAgeFilter());
           // Act
           act(() => result.current.setAgeRange([20, 30]));
           // Assert
           expect(result.current.ageRange).toEqual([20, 30]);

        3. Edge case ì»¤ë²„
        4. Mock ìµœì†Œí™”

    - path: "**/*.spec.{ts,tsx}"
      instructions: |
        ğŸ§ª E2E Test í’ˆì§ˆ:

        1. ì‚¬ìš©ì ê´€ì  ì‹œë‚˜ë¦¬ì˜¤
        2. Accessibility ì²´í¬
        3. ë„¤íŠ¸ì›Œí¬ ëŒ€ê¸° ì²˜ë¦¬ (waitFor)

    # ============================================
    # ğŸ“¦ Design System
    # ============================================
    - path: "packages/design-system/**/*.{ts,tsx}"
      instructions: |
        ğŸ“¦ Design System:

        1. Polymorphic ì»´í¬ë„ŒíŠ¸ (as prop)
           type ButtonProps<C extends ElementType = 'button'> = {
             as?: C;
           } & ComponentPropsWithoutRef<C>;

        2. Compound Pattern
           <Accordion>
             <Accordion.Item>
               <Accordion.Trigger />
               <Accordion.Content />
             </Accordion.Item>
           </Accordion>

        3. ì ‘ê·¼ì„± í•„ìˆ˜
        4. Storybook ë¬¸ì„œí™”

    # ============================================
    # ğŸ” Backend (tRPC + Zod)
    # ============================================
    - path: "apps/server/**/*.ts"
      instructions: |
        ğŸ” tRPC + Zod:

        1. Zodë¡œ ì…ë ¥ ìœ íš¨ì„±
           const createPostSchema = z.object({
             title: z.string().min(1).max(200),
             content: z.string().min(1),
           });

        2. TRPCErrorë¡œ ì—ëŸ¬ ì²˜ë¦¬
           throw new TRPCError({ code: 'NOT_FOUND', message: 'Post not found' });

        3. í•¨ìˆ˜ëª…ì€ ë¶€ìˆ˜íš¨ê³¼ ëª…í™•íˆ
           âœ… createPost, sendEmail, logEvent

        4. íŠ¸ëœì­ì…˜ ì‚¬ìš© (ì—¬ëŸ¬ DB ì‘ì—… ì‹œ)

    # ============================================
    # ğŸ­ Views & Widgets
    # ============================================
    - path: "apps/web/src/views/**/*.{ts,tsx}"
      instructions: |
        ğŸ­ Views (í˜ì´ì§€ ì¡°í•©):

        - Composition íŒ¨í„´ìœ¼ë¡œ features ì¡°í•©
        - âŒ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§/ë°ì´í„° í˜ì¹­/ìƒíƒœ ê´€ë¦¬
        - âœ… ë ˆì´ì•„ì›ƒ, SEO ë©”íƒ€ë°ì´í„°ë§Œ

    - path: "apps/web/src/widgets/**/*.{ts,tsx}"
      instructions: |
        ğŸ­ Widgets (ë…ë¦½ UI ë¸”ë¡):

        - Header, Footer, Sidebar
        - features ì¡°í•© ê°€ëŠ¥
        - ìì²´ ìƒíƒœ ê´€ë¦¬ ê°€ëŠ¥ (ìœ„ì ¯ ë‚´ë¶€ë§Œ)

    # ============================================
    # ğŸ“± Admin Dashboard
    # ============================================
    - path: "apps/admin/src/features/**/*.{ts,tsx}"
      instructions: |
        ğŸ“± Admin CRUD íŒ¨í„´:

        - List: TanStack Table + í•„í„°/ì •ë ¬/í˜ì´ì§€ë„¤ì´ì…˜
        - Create/Edit: React Hook Form + Zod
        - Delete: í™•ì¸ ëª¨ë‹¬ + ë‚™ê´€ì  ì—…ë°ì´íŠ¸
        - columnHelperë¡œ íƒ€ì… ì•ˆì „

    # ============================================
    # ğŸ”„ Shared Packages
    # ============================================
    - path: "packages/shared/**/*.ts"
      instructions: |
        ğŸ”„ Shared (ê³µí†µ ìœ í‹¸):

        - types/: Result<T>, Discriminated Union
        - hooks/: useDebounce, useLocalStorage
        - Zod ìŠ¤í‚¤ë§ˆ
        - ìˆœìˆ˜ í•¨ìˆ˜ ì§€í–¥
        - âŒ any ê¸ˆì§€

# ============================================
# ğŸ› ï¸ Tools Configuration
# ============================================
tools:
  biome:
    enabled: true

# ============================================
# ğŸ“š Knowledge Base
# ============================================
knowledge_base:
  code_guidelines:
    enabled: true
    filePatterns:
      - "**/CLAUDE.md"
      - "**/rules/*.md"
      - "**/.cursorrules"
  learnings:
    scope: "auto"

# ============================================
# ğŸ’¬ Chat
# ============================================
chat:
  auto_reply: true
